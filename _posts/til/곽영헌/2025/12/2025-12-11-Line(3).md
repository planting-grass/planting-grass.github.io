---
title: Line(3)
author: ê³½ì˜í—Œ
date: 2025-12-11
category: TIL/ê³½ì˜í—Œ/2025/12
layout: post
---


# [Refactoring] ë°˜ë³µë¬¸ ì† ê±°ëŒ€í•œ if/switch ì œê±°í•˜ê¸°: 'ê°€ì§œ ìœ ì—°ì„±'ì—ì„œ ë²—ì–´ë‚˜ê¸°



ì˜¤ëŠ˜ì€ ê°œë°œì„ í•˜ë‹¤ ë³´ë©´ ë¬´ì˜ì‹ì ìœ¼ë¡œ ì‘ì„±í•˜ê²Œ ë˜ëŠ” **"ë°˜ë³µë¬¸ ì•ˆì˜ ì¡°ê±´ ë¶„ê¸°"** ë¬¸ì œë¥¼ ë¦¬íŒ©í† ë§í•œ ê³¼ì •ì„ ê³µìœ í•˜ë ¤ í•©ë‹ˆë‹¤. "ìˆœì„œê°€ ìˆëŠ” ë¡œê·¸ ë©”ì‹œì§€ ìƒì„±"ì´ë¼ëŠ” ê°€ìƒì˜ ìš”êµ¬ì‚¬í•­ì„ í†µí•´, ì½”ë“œë¥¼ ì–´ë–»ê²Œ ì ì§„ì ìœ¼ë¡œ ê°œì„ í•  ìˆ˜ ìˆëŠ”ì§€ 4ê°€ì§€ ë‹¨ê³„ë¥¼ í†µí•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.

## 1\. ìƒí™©: ìœ ì—°í•´ ë³´ì´ì§€ë§Œ ìœ„í—˜í•œ ì½”ë“œ

ë¡œê·¸ë¥¼ ì¶œë ¥í•˜ê¸° ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ `Loggable`ê³¼, ë¡œê·¸ ì†ì„±ì„ ì •ì˜í•˜ëŠ” `LogAttribute` Enumì´ ìˆë‹¤ê³  ê°€ì •í•´ ë´…ì‹œë‹¤.

```java
public interface Loggable {
    String getLogType();
    String getLogLevel();
    String getLogDescription();
    // ... timestamp, location ë“±ë“±
}

public enum LogAttribute {
    LOG_TYPE, LOG_LEVEL, LOG_DESCRIPTION
}
```

ê·¸ë¦¬ê³  ìš”êµ¬ì‚¬í•­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

> "ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ì†ì„±(`Set<LogAttribute>`)ë§Œ ê³¨ë¼ì„œ ì¶œë ¥í•˜ë˜, ì¶œë ¥ ìˆœì„œëŠ” \*\*ë¯¸ë¦¬ ì •ì˜ëœ ê·œì¹™(`ORDERED_ATTRIBUTES`)\*\*ì„ ë”°ë¼ì•¼ í•œë‹¤."

ì²˜ìŒì—” ë³„ìƒê° ì—†ì´ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

### âŒ Before: ë°˜ë³µë¬¸ ì•ˆì— ìˆ¨ì€ switch ë¬¸

```java
public class LogService {
    // ìˆœì„œê°€ ë³´ì¥ëœ ë¦¬ìŠ¤íŠ¸
    private static final List<LogAttribute> ORDERED_ATTRIBUTES = List.of(
        LogAttribute.LOG_LEVEL,
        LogAttribute.LOG_TYPE,
        LogAttribute.LOG_DESCRIPTION
    );

    public String createLogMessage(Loggable loggable, Set<LogAttribute> attributesToLog) {
        return ORDERED_ATTRIBUTES.stream()
            .filter(attributesToLog::contains) // ì‚¬ìš©ìê°€ ìš”ì²­í•œ ì†ì„±ë§Œ í•„í„°ë§
            .map(attribute -> {
                // ğŸ˜± ë¬¸ì œì˜ êµ¬ê°„: ë°˜ë³µë¬¸ ë‚´ë¶€ì˜ ë¶„ê¸°
                switch (attribute) {
                    case LOG_LEVEL: return loggable.getLogLevel();
                    case LOG_TYPE: return loggable.getLogType();
                    case LOG_DESCRIPTION: return loggable.getLogDescription();
                    default: return "";
                }
            })
            .collect(Collectors.joining(", "));
    }
}
```

ì´ ì½”ë“œëŠ” ì–¼í• ë³´ë©´ ì˜ ëŒì•„ê°€ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì¹˜ëª…ì ì¸ ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.

1.  **ê°€ë…ì„±:** ì „ì²´ íë¦„ì„ ë³´ë ¤ë©´ ì € ê¸´ `switch` ë¬¸ì„ ë‹¤ ì½ì–´ì•¼ í•©ë‹ˆë‹¤.
2.  **ìœ ì§€ë³´ìˆ˜:** `LogAttribute`ì— ìƒˆë¡œìš´ íƒ€ì…ì´ ì¶”ê°€ë˜ë©´, ì´ê³³ì˜ `switch` ë¬¸ë„ ë°˜ë“œì‹œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤. (ê¹œë¹¡í•˜ë©´ ë²„ê·¸\!)
3.  **ê°€ì§œ ìœ ì—°ì„±:** ë°˜ë³µë¬¸ê³¼ ë¶„ê¸°ê°€ ì„ì—¬ ìˆì–´ êµ¬ì¡°ë§Œ ë³µì¡í•  ë¿, ì‹¤ì§ˆì ì¸ í™•ì¥ì„±ì€ ë‚®ìŠµë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ 4ê°€ì§€ ë¦¬íŒ©í† ë§ ë‹¨ê³„ë¥¼ ì†Œê°œí•©ë‹ˆë‹¤.

-----

## 2\. í•´ê²°ì±… 1: ë°˜ë³µë¬¸ í’€ê¸° (Unrolling Loop)

ì»¬ë ‰ì…˜ì˜ í¬ê¸°ê°€ ì‘ê³  ê³ ì •ì ì´ë¼ë©´, êµ³ì´ ë°˜ë³µë¬¸ì„ ì“¸ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ì§ê´€ì ìœ¼ë¡œ `if`ë¬¸ìœ¼ë¡œ ë‚˜ì—´í•˜ëŠ” ê²ƒì´ ë” ëª…í™•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public String createLogMessage(Loggable loggable, Set<LogAttribute> attributesToLog) {
    List<String> messageParts = new ArrayList<>();

    if (attributesToLog.contains(LogAttribute.LOG_LEVEL)) {
        messageParts.add(loggable.getLogLevel());
    }
    if (attributesToLog.contains(LogAttribute.LOG_TYPE)) {
        messageParts.add(loggable.getLogType());
    }
    // ... ê³„ì† ì¶”ê°€

    return String.join(", ", messageParts);
}
```

  * **ì¥ì :** ì½”ë“œê°€ ë§¤ìš° ë‹¨ìˆœí•˜ê³  íë¦„ì´ í•œëˆˆì— ë³´ì…ë‹ˆë‹¤.
  * **ë‹¨ì :** ì†ì„±ì´ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì½”ë“œê°€ ê¸¸ì–´ì§€ê³ , `join` ê°™ì€ ìœ í‹¸ë¦¬í‹°ë¥¼ ì§ì ‘ êµ¬í˜„í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìƒê¹ë‹ˆë‹¤. ë˜í•œ í•˜ë‚˜ë¼ë„ ë¹¼ë¨¹ëŠ” ì‹¤ìˆ˜ë¥¼ í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.

-----

## 3\. í•´ê²°ì±… 2: ë¶„ê¸° ì¶”ì¶œ (Extract Method)

`switch` ë¬¸ì´ ë³´ê¸° ì‹«ë‹¤ë©´ ë³„ë„ ë©”ì„œë“œë¡œ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public String createLogMessage(Loggable loggable, Set<LogAttribute> attributesToLog) {
    return ORDERED_ATTRIBUTES.stream()
            .filter(attributesToLog::contains)
            .map(attr -> getLogText(attr, loggable)) // ë©”ì„œë“œ ì¶”ì¶œ
            .collect(Collectors.joining(", "));
}

private String getLogText(LogAttribute attribute, Loggable loggable) {
    return switch (attribute) {
        case LOG_LEVEL -> loggable.getLogLevel();
        case LOG_TYPE -> loggable.getLogType();
        default -> throw new IllegalArgumentException("Unknown attribute");
    };
}
```

  * **ì¥ì :** ë©”ì¸ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(`createLogMessage`)ì´ ê¹”ë”í•´ì§‘ë‹ˆë‹¤.
  * **ë‹¨ì :** ê·¼ë³¸ì ì¸ í•´ê²°ì±…ì€ ì•„ë‹™ë‹ˆë‹¤. ì—¬ì „íˆ `Enum` ì •ì˜ì™€ `getLogText` ë¡œì§ ì‚¬ì´ì˜ ê²°í•©ë„ëŠ” ëŠìŠ¨í•˜ì—¬, êµ¬í˜„ ëˆ„ë½ì˜ ìœ„í—˜ì´ ì¡´ì¬í•©ë‹ˆë‹¤.

-----

## 4\. í•´ê²°ì±… 3: Enumì— ë¡œì§ ìœ„ì„ (Strategy Pattern)

Javaì˜ `Enum`ì€ ê°•ë ¥í•©ë‹ˆë‹¤. ê° ìƒìˆ˜ë³„ë¡œ ì¶”ìƒ ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ê²Œ í•˜ì—¬ **ì „ëµ íŒ¨í„´**ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
public enum LogAttribute {
    LOG_LEVEL {
        @Override
        public String getText(Loggable loggable) {
            return loggable.getLogLevel();
        }
    },
    LOG_TYPE {
        @Override
        public String getText(Loggable loggable) {
            return loggable.getLogType();
        }
    },
    // ...
    ;
    
    // ì¶”ìƒ ë©”ì„œë“œ ì •ì˜ (ì»´íŒŒì¼ëŸ¬ê°€ êµ¬í˜„ì„ ê°•ì œí•¨)
    public abstract String getText(Loggable loggable);
}

// Service ì½”ë“œ
public String createLogMessage(Loggable loggable, Set<LogAttribute> attributesToLog) {
    return ORDERED_ATTRIBUTES.stream()
            .filter(attributesToLog::contains)
            .map(attr -> attr.getText(loggable)) // ë¶„ê¸° ì œê±°! ë‹¤í˜•ì„± í™œìš©
            .collect(Collectors.joining(", "));
}
```

  * **ì¥ì :** **ì‘ì§‘ë„ ìµœê°•.** ìƒˆë¡œìš´ íƒ€ì…ì´ ì¶”ê°€ë  ë•Œ `getText`ë¥¼ êµ¬í˜„í•˜ì§€ ì•Šìœ¼ë©´ ì»´íŒŒì¼ ì—ëŸ¬ê°€ ë°œìƒí•˜ë¯€ë¡œ ì‹¤ìˆ˜ë¥¼ ì›ì²œ ì°¨ë‹¨í•©ë‹ˆë‹¤.
  * **ë‹¨ì :** `LogAttribute`ë¼ëŠ” ë„ë©”ì¸ ëª¨ë¸ì— 'ë¡œê·¸ ë¬¸ìì—´ ìƒì„±'ì´ë¼ëŠ” íŠ¹ì • ë¡œì§ì´ ì„ì…ë‹ˆë‹¤. Enumì´ ë„ˆë¬´ ë¹„ëŒ€í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

-----

## 5\. í•´ê²°ì±… 4: íŠœí”Œ(Tuple)ë¡œ ê´€ê³„ ëª…ì‹œí•˜ê¸° (Recommended)

ë§ˆì§€ë§‰ì€ **íƒ€ì…(Key)ê³¼ ë¡œì§(Function)** ì„ ë§¤í•‘í•˜ëŠ” íŠœí”Œì„ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤. Java 14ë¶€í„° ë„ì…ëœ `Record`ë¥¼ í™œìš©í•˜ë©´ ê¹”ë”í•©ë‹ˆë‹¤.

```java
import java.util.function.Function;

public class LogService {
    
    // 1. (Enum íƒ€ì…, ë¡œì§ í•¨ìˆ˜)ë¥¼ ë‹´ëŠ” ë¶ˆë³€ ê°ì²´ ì •ì˜
    private record AttributeMapping(
        LogAttribute attribute, 
        Function<Loggable, String> textExtractor
    ) {}

    // 2. ìˆœì„œì™€ ë¡œì§ì„ í•œ ê³³ì—ì„œ ì •ì˜ (í…Œì´ë¸” í˜•íƒœ)
    private static final List<AttributeMapping> ORDERED_MAPPINGS = List.of(
        new AttributeMapping(LogAttribute.LOG_LEVEL, Loggable::getLogLevel),
        new AttributeMapping(LogAttribute.LOG_TYPE,  Loggable::getLogType),
        new AttributeMapping(LogAttribute.LOG_DESCRIPTION, Loggable::getLogDescription)
    );

    public String createLogMessage(Loggable loggable, Set<LogAttribute> attributesToLog) {
        return ORDERED_MAPPINGS.stream()
            // 3. íŠœí”Œì˜ Enumì„ í™•ì¸í•˜ì—¬ í•„í„°ë§
            .filter(mapping -> attributesToLog.contains(mapping.attribute()))
            // 4. íŠœí”Œì— ë§¤í•‘ëœ í•¨ìˆ˜(Extractor) ì‹¤í–‰
            .map(mapping -> mapping.textExtractor().apply(loggable))
            .collect(Collectors.joining(", "));
    }
}
```

  * **ì¥ì :**
      * **ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬:** Enumì€ ìˆœìˆ˜í•˜ê²Œ ë‘ê³ , ë¡œì§ì€ Service ë‚´ë¶€ì— `List`ë¡œ ì •ì˜í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.
      * **ìœ ì—°ì„±:** `Function<Loggable, String>` ì¸í„°í˜ì´ìŠ¤ë¥¼ í™œìš©í•´ ì–´ë–¤ ë¡œì§ì´ë“  ìœ ì—°í•˜ê²Œ ë¼ì›Œ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  * **ë‹¨ì :** ëª¨ë“  Enum ê°’ì´ ë§¤í•‘ë˜ì—ˆëŠ”ì§€ ì»´íŒŒì¼ íƒ€ì„ì— ì²´í¬í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. (ì´ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¡œ ë³´ì™„í•´ì•¼ í•©ë‹ˆë‹¤.)

-----

## ğŸ’¡ ê²°ë¡ : ë¬´ì—‡ì„ ì„ íƒí•´ì•¼ í• ê¹Œ?

  * **ê°„ë‹¨í•˜ê³  íƒ€ì…ì´ ì ë‹¤?** ğŸ‘‰ `if` ë¬¸ìœ¼ë¡œ í’€ì–´ì„œ ì“°ì„¸ìš” (Loop Unrolling).
  * **íƒ€ì…ê³¼ ë¡œì§ì´ ë—„ ìˆ˜ ì—†ëŠ” ê´€ê³„ë‹¤?** ğŸ‘‰ Enum ë‚´ë¶€ êµ¬í˜„ (Strategy Pattern).
  * **Enumì€ ì—¬ëŸ¬ ê³³ì—ì„œ ì“°ì´ê³ , ë¡œì§ì€ ì´ ì„œë¹„ìŠ¤ë§Œì˜ ê²ƒì´ë‹¤?** ğŸ‘‰ **ë§¤í•‘ íŠœí”Œ(Mapping Tuple)** ë°©ì‹ì„ ê°•ë ¥ ì¶”ì²œí•©ë‹ˆë‹¤.

-----
