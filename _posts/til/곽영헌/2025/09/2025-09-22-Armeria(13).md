---
title: Armeria(13)
author: ê³½ì˜í—Œ
date: 2025-09-22
category: TIL/ê³½ì˜í—Œ/2025/09
layout: post
---

### ì˜¤ëŠ˜ í•œ ê²ƒ

- ì»¨íŠ¸ë¦¬ë·°í„°ì˜ ì˜¤ëœë§Œì— ì½”ë“œë¦¬ë·° ëŒ€ì‘

I found a couple of issues in the generated JSON schema:

    There are many duplicate definitions because each method has its own ID and definitions.

    [
      {
        "$id": "...",
        "definitions": { ... } // duplicate definitions
      },
      {
        "$id": "...",
        "definitions": { ... } // duplicate definitions
      }
    ]

    The "Cat" and "Dog" definitions are missing the species property, which is causing Autocomplete to fail.

To address this, I propose the following:

    Use a root object with "$defs/methods" and "$defs/models" to put all methods and structs a single time.
        It's worth noting that "definitions" is deprecated, as mentioned in the JSON Schema draft specification. https://json-schema.org/draft/2020-12/draft-bhutton-json-schema-00#rfc.appendix.G

    {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "$id": "...",
      "title": "...",

      "$defs": {
        "methods": {
          "processAnimal": {
            "$id": "com.linecorp.armeria.server.docs.PolymorphismDocServiceTest$AnimalService/processAnimal/POST",
            "title": "processAnimal",
            "type": "object",
            "properties": {
              "animal": {
                "$ref": "#/$defs/models/Animal" 
              }
            },
            "required": [ "animal" ]
          },
          "processZoo": {
            ...
          }
        },

        "models": {
          "Animal": {
            "type": "object",
            "oneOf": [
              { "$ref": "#/$defs/models/Dog" },
              { "$ref": "#/$defs/models/Cat" }
            ],
            "discriminator": {
              "propertyName": "species",
              "mapping": {
                "dog": "#/$defs/models/Dog",
                "cat": "#/$defs/models/Cat"
              }
            }
          },
          "Cat": {
            "type": "object",
            "properties": {
              "species": { "type": "string" },
              "name": { "type": "string" },
              "likesTuna": { "type": "boolean" },
              "scratchPost": { "$ref": "#/$defs/models/Toy" },
              "vetRecord": { "$ref": "#/$defs/models/VetRecord" }
            },
            "required": [ "name", "likesTuna", "scratchPost", "vetRecord" ]
          },
          "Dog": {
            ...
          },
          ...
        }
      }
    }

    Update RequestBody.tsx to align with the new schema format. (I might help you if you are not familiar with the frontend)

Please, let me know your opinion. ğŸ™‡




---


ê·¸ë˜ì„œ êµ¬í˜„ì„ í•˜ê¸´ í–ˆëŠ”ë°, gRPCì™€ ì—°ê´€ëœ ë‹¤ë¥¸ ë¶€ë¶„ì—ì„œ ì—ëŸ¬ê°€ ìƒê²¨ì„œ ì–´ë–»ê²Œ í• ì§€ ë¬¼ì–´ë³´ëŸ¬ í•¨.