---
title: 2025-11-07
author: ì¡°ìˆ˜ì•„
date: 2025-11-07
category: TIL/ì¡°ìˆ˜ì•„/2025/11
layout: post
---

# ì˜¤ëŠ˜ ë°°ìš´ ê²ƒ

## ğŸ“Œ ì •ì˜

> í•˜ë‚˜ì˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í–ˆëŠ”ë°, ì—°ê´€ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠë¼ ì¶”ê°€ ì¿¼ë¦¬ê°€ Në²ˆ ë°œìƒí•˜ëŠ” ë¬¸ì œ
> 

ì¦‰,

**1ë²ˆì˜ ì¡°íšŒ ì¿¼ë¦¬ + Në²ˆì˜ ì¶”ê°€ ì¿¼ë¦¬ â†’ ì´ N+1 ì¿¼ë¦¬ ë°œìƒ!**

---

## ğŸ¯ ì˜ˆì‹œ ìƒí™©

```java
@Entity
public class Team {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany(mappedBy = "team")
    private List<Member> members;
}

@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @ManyToOne(fetch = FetchType.LAZY)
    private Team team;
}

```

---

## ğŸ§¨ ë¬¸ì œê°€ ë˜ëŠ” ì½”ë“œ

```java
java
ì½”ë“œ ë³µì‚¬
List<Team> teams = teamRepository.findAll(); // âœ… ì¿¼ë¦¬ 1ë²ˆ

for (Team team : teams) {
    System.out.println(team.getMembers());  // â— ë§¤ íŒ€ë§ˆë‹¤ ì¿¼ë¦¬ Në²ˆ
}

```

### ğŸ‘‰ ì‹¤í–‰ ì¿¼ë¦¬ ìš”ì•½

```sql
sql
ì½”ë“œ ë³µì‚¬
SELECT * FROM team;          -- 1ë²ˆ
SELECT * FROM member WHERE team_id = 1;  -- Në²ˆ ë°˜ë³µ
SELECT * FROM member WHERE team_id = 2;
...

```

> âœ… ì˜ˆìƒ: 1ë²ˆ ì¿¼ë¦¬
> 
> 
> âŒ ì‹¤ì œ: N+1 ì¿¼ë¦¬ â†’ ì„±ëŠ¥ ì €í•˜
> 

---

## ğŸ“¦ ë°œìƒ ì›ì¸

| ì›ì¸ | ì„¤ëª… |
| --- | --- |
| **ì—°ê´€ê´€ê³„ì˜ ê¸°ë³¸ fetch ì „ëµ** | `@OneToMany`, `@ManyToOne` â†’ ê¸°ë³¸ì´ LAZY |
| **ê°ì²´ë¥¼ ìˆœíšŒí•˜ë©° getter í˜¸ì¶œ** | ê·¸ ì‹œì ì— ì‹¤ì œ ì¿¼ë¦¬ ë‚ ë¦¼ (í”„ë¡ì‹œ ì´ˆê¸°í™”) |

---

## âœ… í•´ê²° ë°©ë²• 1: **Fetch Join**

> JPQLë¡œ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì— JOINí•´ì„œ ê°€ì ¸ì˜¤ê¸°
> 

```java
@Query("SELECT t FROM Team t JOIN FETCH t.members")
List<Team> findAllWithMembers();
```

âœ… ì‹¤í–‰ ì¿¼ë¦¬:

```sql
SELECT t.*, m.* FROM team t
JOIN member m ON t.id = m.team_id
```

â†’ Teamê³¼ Memberë¥¼ í•œ ë²ˆì— ì¡°íšŒ!

---

## âœ… í•´ê²° ë°©ë²• 2: `@EntityGraph`

> JPQL ì—†ì´ fetch joinì²˜ëŸ¼ ì‘ë™
> 

```java
@EntityGraph(attributePaths = "members")
List<Team> findAll();
```

---

## âœ… í•´ê²° ë°©ë²• 3: BatchSize (for LAZY ì»¬ë ‰ì…˜)

> JPAê°€ IN ì¿¼ë¦¬ë¡œ ëª¨ì•„ì„œ í•œë²ˆì— ê°€ì ¸ì˜¤ë„ë¡ ì„¤ì •
> 

```java
@BatchSize(size = 100)
@OneToMany(mappedBy = "team")
private List<Member> members;
```

ë˜ëŠ” application.yml:

```yaml
spring:
  jpa:
    properties:
      hibernate.default_batch_fetch_size: 100
```